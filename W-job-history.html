<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hirewale ¬∑ Job History</title>
  <style>
    :root{
      --brand-600:#0ea5e9;
      --brand-700:#0284c7;
      --brand-success:#16a34a;
      --brand-danger:#dc2626;
      --ink:#0f172a;
      --card-bg:#ffffff;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto;}
    body{
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 10% 10%, #e0f2fe 0%, transparent 60%),
        radial-gradient(1000px 500px at 90% 20%, #bae6fd 0%, transparent 60%),
        linear-gradient(180deg, #f0f9ff 0%, #ffffff 40%, #f8fafc 100%);
      color:var(--ink);
      display:flex;
      justify-content:center;
      padding:32px 0;
    }
    .dashboard{width:min(100%,960px);display:grid;gap:24px;padding:0 16px;}
    .card{background:var(--card-bg);border-radius:16px;padding:20px;box-shadow:0 6px 16px rgba(0,0,0,0.08);}
    h2{font-size:20px;margin-bottom:16px;}
    .job-card{
      border:1px solid #e2e8f0;
      border-radius:12px;
      padding:16px;
      margin-bottom:16px;
      box-shadow:0 3px 8px rgba(0,0,0,0.05);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .job-title{font-weight:600;font-size:16px;}
    .job-details{font-size:14px;color:#334155;}
    .actions{display:flex;gap:12px;margin-top:8px;}
    .btn{
      padding:10px 16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      color:white;
    }
    .btn:hover{
      transform:translateY(-2px) scale(1.03);
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
    }
    .done{background:var(--brand-success);}
    .done:hover{background:#15803d;}
    .back-btn{background:var(--brand-600);}
    .back-btn:hover{background:var(--brand-700);}
    /* Modal */
    .modal-overlay{
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.5);
      justify-content:center;
      align-items:center;
      z-index:1000;
    }
    .modal-content{
      background:white;
      padding:24px;
      border-radius:16px;
      max-width:360px;
      text-align:center;
      animation:bounceIn 0.45s ease;
    }
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.8); }
      60% { opacity: 1; transform: scale(1.05); }
      80% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    .modal-content .confirm{background:var(--brand-success);color:white;padding:8px 16px;border-radius:8px;border:none;cursor:pointer;}
    .modal-content .cancel{background:var(--brand-danger);color:white;padding:8px 16px;border-radius:8px;border:none;cursor:pointer;margin-left:8px;}
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="card">
      <h2>Job History</h2>
      <div id="jobHistory"></div>
      <button class="btn back-btn" onclick="window.location.href='W-dashboard.html'">‚¨Ö Back to Dashboard</button>
    </div>
  </div>

  <!-- Modal -->
  <div id="doneModal" class="modal-overlay">
    <div class="modal-content">
      <p id="modalMessage" style="margin-bottom:20px;"></p>
      <div style="display:flex;justify-content:center;">
        <button id="confirmDone" class="confirm">Confirm</button>
        <button id="cancelDone" class="cancel">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let jobs = JSON.parse(sessionStorage.getItem("jobs")) || [];
    let earnings = parseInt(sessionStorage.getItem("walletBalance")) || 5000;

    const jobHistory = document.getElementById("jobHistory");
    const modal = document.getElementById("doneModal");
    const modalMsg = document.getElementById("modalMessage");
    const confirmBtn = document.getElementById("confirmDone");
    const cancelBtn = document.getElementById("cancelDone");

    let selectedJob = null;

    function renderHistory() {
      jobHistory.innerHTML = "";
      const historyJobs = jobs.filter(j => j.status === "accepted" || j.status === "done");
      if (historyJobs.length === 0) {
        jobHistory.innerHTML = "<p>No job history available.</p>";
        return;
      }
      historyJobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "job-card";
        div.innerHTML = `
          <div class="job-title">${job.title}</div>
          <div class="job-details">üìç ${job.location}</div>
          <div class="job-details">üí∞ ‚Çπ${job.pay}</div>
          <div class="job-details">Status: <strong>${job.status}</strong></div>
          ${job.status === "accepted" ? `<div class="actions"><button class="btn done" onclick="openModal(${job.id})">Mark as Done</button></div>` : ""}
        `;
        jobHistory.appendChild(div);
      });
    }

    function openModal(jobId) {
      selectedJob = jobs.find(j => j.id === jobId);
      modalMsg.textContent = `Mark "${selectedJob.title}" as done?`;
      modal.style.display = "flex";
    }

    cancelBtn.addEventListener("click", () => {
      modal.style.display = "none";
      selectedJob = null;
    });

    confirmBtn.addEventListener("click", () => {
      if (selectedJob) {
        selectedJob.status = "done";
        earnings += selectedJob.pay;
        sessionStorage.setItem("walletBalance", earnings);
        addNotification(`üõ† Completed job: ${selectedJob.title} and earned ‚Çπ${selectedJob.pay}`, "success");
        sessionStorage.setItem("jobs", JSON.stringify(jobs));
        renderHistory();
      }
      modal.style.display = "none";
    });

    // Persistent notifications (with timestamp)
    function addNotification(message, type="info") {
      const saved = JSON.parse(sessionStorage.getItem("notifications")) || [];
      saved.unshift({message, type, time: Date.now()});
      sessionStorage.setItem("notifications", JSON.stringify(saved));
    }

    renderHistory();
  </script>
</body>
</html>
